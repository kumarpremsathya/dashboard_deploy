{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{% static 'market_data/css/stylesheet.css' %}" type="text/css"/> 
    
    <script src="{% static 'script.js' %}"></script>
    

    <style>
        .container{
       display:grid;
      grid-template-rows:8vh 10vh 72vh 10vh;
      grid-template-columns:300px auto;
       grid-template-areas: 
       "one two two two"
       "one three three three"
       "one four four four "
       "one five five five";
       gap:10px;
   }
   .one{grid-area: one;}
   .two{grid-area: two;}
   .three{grid-area: three;}
   .four{grid-area: four;}
   .five{grid-area: five;}
  
   </style>
</head>
<body>

<div class="container">
    <div class="one">
        <div id="mySidenav" class="sidenav">
        <a href="#">
            <i class="fa fa-home" aria-hidden="true"style="font-size: 30px;position:relative;top:150px;"></i>
            <h2 style="display: inline; margin-left: 5px;position:relative;top:150px;">HOME</h2>
        </a>
        <P><a class="links" href="{% url 'rbinewhome' %}">   Probe Agile Data</a></p>
		<span><a class="links" href="{% url 'table_details2' %}"> Market Data  </a></span>
        <p class="logo"><span> Data sources</span></p><hr>
       
        <!-- {% for table_name in table_names %}
            <a href="{% url 'table_details' table_name %}" style="font-weight: bold;">
                &nbsp;{{ table_name }}</a>
        {% endfor %} -->

         <!-- In your template where you generate links -->
         {% for table_name, url_name in url_friendly_names %}
         <a href="{% url 'table_details' url_name %}" class="table-link">&nbsp;{{ table_name }}</a>
         {% endfor %}  
       </div>
    </div>


        <div class="two">
            <div class="col-div-6">
                <span style="font-size:30px;cursor:pointer; color: #f7403b;" class="nav">  Data Extraction Status for Market Data Sources </span>
            </div>
        </div>
            
        <div class="three">
                <div class="box">
                     <p> Metrics from "{{ yesterday|date:"d-m-Y" }}"  to "{{ start_date|date:"d-m-Y" }}"</P>
                </div>
        </div>
     

        
    
<div class="four">
     <div class="content-box">
        <title>All Table Details</title>
            {% if structured_data %}
    <div class="card">
        <div style="display: flex;">
        <div class="left" style="flex: 1;">
            <table >
                <thead><tr> <td rowspan="2" style="text-align: center; padding: 29px; color: #6408f7; font-size: 16px; font-weight: bold; text-transform: capitalize;width: 150px;">
                    Data source
                  </td></tr></thead>
              <tbody>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_company_master');"> ace_company_master </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_new_equity');"> bse_new_equity </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_company_equity');">ace_company_equity </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_company_equity_cons');">ace_company_equity_cons </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_52whl');"> ace_52whl </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_market_capital');">bse_market_capital </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_financial_PROV');">bse_financial_PROV </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_financial_QC');"> bse_financial_QC </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_finance_Quarterly');"> ace_finance_Quarterly </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_finance_Quarterly_Cons');">ace_finance_Quarterly_Cons </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_Finance_cf');">ace_Finance_cf </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_Finance_cons_cf');"> ace_Finance_cons_cf </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_Finance_fr');">ace_Finance_fr </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_Finance_bs');"> ace_Finance_bs</a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_Finance_cons_bs');"> ace_Finance_cons_bs</a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('Capitaline_standalone');"> Capitaline_standalone</a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('Capitaline_consolidated');">Capitaline_consolidated </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_pledge');">bse_pledge </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('nse_pledge_new');">nse_pledge_new </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse_shp');"> bse_shp</a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('ace_shp');"> ace_shp </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('NSE security list equity segment');"> NSE security list equity segment </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('NSE security list trading sme');"> NSE security list trading sme </a></td></tr>
                <tr><td style="text-align: left;"><a href="#" onclick="openPopup('bse security list');"> bse security list </a></td></tr>
              </tbody>
            </table>
          </div>
          <table>
            <thead>
            <tr> <td rowspan="2" style="text-align: center; padding: 29px; color: #6408f7; font-size: 16px; font-weight: bold; text-transform: capitalize;width: 150px;">
                Status
              </td></tr>
            </thead>
            <tbody>
                {% for table_name, date_data in structured_data.items %}
                    <tr>
                        {% for date, entry in date_data.items %}
                            {% if forloop.counter == 1 %} {# Only display for the first day #}
                            <td style="color: {% if entry.source_status == 'Active' %} green {% elif entry.source_status == 'Inactive' %} red {% else %} orange {% endif %}; font-weight: bold; font-size: 15px;">
                                    {% if entry.source_status %}
                                        {{ entry.source_status }}
                                    {% else %}
                                        -
                                    {% endif %}
                            </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
          <table>
            <thead>
                <tr> <td rowspan="2" style="text-align: center; padding: 29px; color: #6408f7; font-size: 16px; font-weight: bold; text-transform: capitalize;width: 150px;">
                    #Records
                  </td></tr>
            </thead>
            <tbody>
                {% for table_name, date_data in structured_data.items %}
                    <tr>
                        {% for date, entry in date_data.items %}
                            {% if forloop.counter == 1 %} {# Only display for the first day #}
                                <td style= "color: #6408f7; font-weight:400px;font-size: 15px;">
                                    {% if entry.total_record_count %}
                                        {{ entry.total_record_count }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
          </table>
        <table>
            <thead>
                <tr>
                    {% for date in date_range %}
                        <th colspan="2" style="text-align: center;">{{ date|date:"d-m-Y" }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for date in date_range %}
                        <th>Available</th>
                        <th>Scraped</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for table_name, date_data in structured_data.items %}
                    <tr>
                        {% for date, entry in date_data.items %}
                            <td>
                                {% if entry.no_of_data_available %}
                                    {{ entry.no_of_data_available }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td style="padding: 5px;">
                                <span style="color: {% if entry.status|lower == 'success' %} green {% elif entry.status == 'failure' and table_name in amber_table_names %} orange {% else %} red {% endif %}">
                                    {% if entry.no_of_data_scraped %}
                                        {{ entry.no_of_data_scraped }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </span>
                            </td>                            
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p> select a valid date range </p>
{% endif %}
</div>
</div> 
</div>


        
	

      <div class="five">
			<div class="col-div-4" style="text-align:center;">
                <div style="text-align: center;">
				<p style="color: red;font-size:21px;"> Contact us for support : <a href="mailto:agiledatahelp@gmail.com" target="_blank" rel="noopener noreferrer" style="color: red;font-size:21px;">agiledatahelp@gmail.com</a></p>
			</div>
		</div>
    </div>
     
</div>


	
<script src="{% static 'market_data/js/pivottable.js' %}"></script>
	</body>
	</html>